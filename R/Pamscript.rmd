---
title: "Pamscript"
author: "Nash Soderberg"
date: "1/8/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library("devtools")
library("steponeR")
library("janitor")
```
## Background
This experiment was composed of 2 treatment periods. The first treatment period had 3 groups differentiated by their environmental conditions: high temperature (HT), high light (HL), and control (C). The second stress separated each of these 3 groups evenly into 2 groups each: high temperature (HT), and control(C). Separating the corals into 3 groups, and then again splitting each of those groups into 2 resulted in 6 total groups with unique treatment histories.

To monitor the conditions of the corals, one of the things measured along the course of the experiment was fv/fm. This is measured via PAM flourometry. This method is often used to obtain fv/fm values which can be used as a proxy to determine the amount of symbiont cells in a particular coral. 

## Loading the PAM Data
The PAM data was saved in .tsv files, which need to be read into a dataframe in R. Also, the date in these dataframes needs to be read as a date as well. 
```{r load_data}
pam01 <- read.table(file = "data/pam/pam20180131.tsv", fill = TRUE, header = T, sep = "\t")
pam01 <- pam01[,1:3]
pam01$date <- as.Date("2018-01-31")

pam02 <- read.table(file = "data/pam/pam20180202.tsv", fill = TRUE, header = T, sep = "\t")
pam02 <- pam02[,1:3]
pam02$date <- as.Date("2018-02-02")

pam03 <- read.table(file = "data/pam/pam20180205.tsv", fill = TRUE, header = T, sep = "\t")
pam03 <- pam03[,1:3]
pam03$date <- as.Date("2018-02-05")

pam04 <- read.table(file = "data/pam/pam20180207.tsv", fill = TRUE, header = T, sep = "\t")
pam04 <- pam04[,1:3]
pam04$date <- as.Date("2018-02-07")

pam05 <- read.table(file = "data/pam/pam20180209.tsv", fill = TRUE, header = T, sep = "\t")
pam05 <- pam05[,1:3]
pam05$date <- as.Date("2018-02-09")

pam06 <- read.table(file = "data/pam/pam20180212.tsv", fill = TRUE, header = T, sep = "\t")
pam06 <- pam06[,1:3]
pam06$date <- as.Date("2018-02-12")

pam07 <- read.table(file = "data/pam/pam20180214.tsv", fill = TRUE, header = T, sep = "\t")
pam07 <- pam07[,1:3]
pam07$date <- as.Date("2018-02-14")

pam08 <- read.table(file = "data/pam/pam20180216.tsv", fill = TRUE, header = T, sep = "\t")
pam08 <- pam08[,1:3]
pam08$date <- as.Date("2018-02-16")

pam10 <- read.table(file = "data/pam/pam20180228.tsv", fill = TRUE, header = T, sep = "\t")
pam10 <- pam10[,1:3]
pam10$date <- as.Date("2018-02-28")

pam11 <- read.table(file = "data/pam/pam20180321.tsv", fill = TRUE, header = T, sep = "\t")
pam11 <- pam11[,1:3]
pam11$date <- as.Date("2018-03-21")

pam12 <- read.table(file = "data/pam/pam20180523.tsv", fill = TRUE, header = T, sep = "\t")
pam12 <- pam12[,1:3]
pam12$date <- as.Date("2018-05-23")

pam13 <- read.table(file = "data/pam/pam20180525.tsv", fill = TRUE, header = T, sep = "\t")
pam13 <- pam13[,1:3]
pam13$date <- as.Date("2018-05-25")

pam14 <- read.table(file = "data/pam/pam20180526.tsv", fill = TRUE, header = T, sep = "\t")
pam14 <- pam14[,1:3]
pam14$date <- as.Date("2018-05-26")

pam15 <- read.table(file = "data/pam/pam20180527.tsv", fill = TRUE, header = T, sep = "\t")
pam15 <- pam15[,1:3]
pam15$date <- as.Date("2018-05-27")

pam16 <- read.table(file = "data/pam/pam20180528.tsv", fill = TRUE, header = T, sep = "\t")
pam16 <- pam16[,1:3]
pam16$date <- as.Date("2018-05-28")

pam17 <- read.table(file = "data/pam/pam20180528.tsv", fill = TRUE, header = T, sep = "\t")
pam17 <- pam17[,1:3]
pam17$date <- as.Date("2018-05-28")

pam18 <- read.table(file = "data/pam/pam20180529.tsv", fill = TRUE, header = T, sep = "\t")
pam18 <- pam18[,1:3]
pam18$date <- as.Date("2018-05-29")
```

## Creating and Manipulating pamtotal
These separate dataframes need to be added together into one dataframe, named pamtotal, which 
will be manipulated to be the master dataframe for data analysis.

```{r}
pamtotal <- rbind(pam01, pam02, pam03, pam04, pam05, pam06, pam07, pam08, pam10, pam11, pam12, pam13, pam14, pam15, pam16, pam17, pam18)
```

There are discrepancies in how the "Tank" column are formatted between some of the later and earlier PAM sheets, so this needs to be corrected

```{r}
pamtotal$Tank <- replace(pamtotal$Tank, pamtotal$Tank=="6AC", "6A-C")
pamtotal$Tank <- replace(pamtotal$Tank, pamtotal$Tank=="6AH", "6A-HT")
pamtotal$Tank <- replace(pamtotal$Tank, pamtotal$Tank=="7AC", "7A-C")
pamtotal$Tank <- replace(pamtotal$Tank, pamtotal$Tank=="7AH", "7A-HT")
pamtotal$Tank <- replace(pamtotal$Tank, pamtotal$Tank=="7BC", "7B-C")
pamtotal$Tank <- replace(pamtotal$Tank, pamtotal$Tank=="7BH", "7B-HT")

```

Next, the treatment that each coral experienced will be added into a new column in pamtotal. This is obtained from the "Tank" column, so we need to convert this column to characters and then extract the treatment from those characters.

```{r}
pamtotal1$Tank <- as.character(pamtotal1$Tank) #converts to char

if (nchar(pamtotal$Tank, type = "chars", allowNA = FALSE, keepNA = NA) > 3) {
pamtotal$treatment <- substr(pamtotal$Tank, 4, 5)
} else {
  pamtotal$treatment <- substr(pamtotal$Tank, 3, 3)
}
```

## Plotting the First Stress
To begin looking at this data, the different stressing events will be viewed individually. To plot the first stress, we made a separate dataframe specifically for the points of interest.

```{r}

```

